#!/bin/bash
#
# gitcherrypick
#
# Provide some automation
#

# This script needs a bash library source file
#
source ~/bin/lib/ui.source

echo
echo "gitcherrypick"
echo
echo -e "\tAutomates cherrypicking"
echo -e "\tPress 'x' or 'q' to exit at any prompt."
echo

commitmessagefile="../scratch/originalcommitmessage"

getuser "\nPress \"y\" to finish previous session.\n\
Press \"Enter\" to skip this step.\nCherrypick commit: " commit
if [ ! -z $commit ]; then

	conflictsflag=false
	git cherry-pick "$commit"
	git status
	while true; do
		getyn "Conflicts to fix?" conflicts
		conflictsflag=true
		if [ "$conflicts" == "y" ]; then
			getuser "File to edit: " file
			vim "$file"
			git add "$file"
		else
			break
		fi
	done

	if [ $conflictsflag ]; then
		git commit -C "$commit"
	fi

	git log -n1 > $commitmessagefile
	git commit -s --amend --reset-author --file=$commitmessagefile
fi

echo
echo "Done."
echo
