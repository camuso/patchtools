#!/bin/bash

rev=""
show_b=true
declare -i optcount=0
declare -a alist		# alternate branch list
declare -a blist		# current branch list

while getopts :p:rb OPTION; do
    case "$OPTION" in

	r ) rev="--reverse"
	    optcount=$((optcount+1))
	    ;;
	b ) show_b=false
	    optcount=$((optcount+1))
	    ;;
	p ) pathspec=$OPTARG
	    optcount=$((optcount+2))
	    ;;
	* ) echo "unrecognized option -$OPTION"
	    echo -e "$usagestr"
	    exit 127
    esac
done

shift $optcount
commit_expr="$1"
pathspec="$2"

blist=($(git log $rev "$commit_expr" $pathspec \
	| grep '^commit' | cut -d' ' -f2))

alist=($(git log $rev "$commit_expr" $pathspec \
	| grep '    commit' | cut -d' ' -f6))

for ((i=0; i < ${#blist[@]}; ++i)); do
	astr=$(gitnice -d -1 "${alist[$i]}")
	bstr=$"${blist[$i]:0:8}"
	if $show_b; then
		echo "$bstr  $astr"
	else
		echo "$astr"
	fi
done

