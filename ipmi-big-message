#!/bin/bash
#
# ipmi-big-message

declare usagestr=$(
cat <<EOF

$(basename $0) 

Description: Sends a large, 132-byte message to the BMC using ipmitool.
             ipmitool must be installed.

Arguments:   No arguments. Any arguments will invoke this help screen.

\0
EOF
)

usage() {
	echo -en "$usagestr"
	exit 1
}

tags="THUNDERX-1567"

# From: Joyce5 Chen(陳怡潔_Pegatron)
# [mailto:Joyce5_Chen@pegatroncorp.com] Sent: Friday, June 15, 2018
# 5:01 PM To: Chan, Ziv <ziv.chan@hpe.com>; Tsai, Robert
# <robert.tsai@hpe.com>; bruce1_yang@pegatroncorp.com; Chen, Alpha
# (Alpha Chen) <alpha.chen@hpe.com>; Kiran Kolukuluru <kirank@ami.com>;
# Michael Hsu(許仲翔_Pegatron) <Michael_Hsu@pegatroncorp.com>; Balaji
# Nagalingam Rajendiran <balajinr@ami.com>; Karthikeyan M
# <karthikeyanm@amiindia.co.in>; Scott, Matthew
# <matthewisol.scott@hpe.com> Cc: Landry, Mitch
# <mitchell.landry@hpe.com>; Rojas, Alonso
# <alonso.rojas-chacon@hpe.com>; Hung, Rex <rex.hung@hpe.com>; Kuan,
# Bob <bob.kuan@hpe.com>; %C01_EE <C01_EE@pegatroncorp.com>; Yin, Tom
# <tom.yin@hpe.com> Subject: RE: Apache BMC host name write
# Dear Ziv,
# I've test again with inband command. Here's my result.
# 1.
# My ssif is OK because I can get the bmc info via IPMItool.
# 2. I issue the inband command with 132bytes to set the host name.But
# it reply "Unexpecified error"
# ipmitool raw 0x32 0x6c 1 0 0x0 0xd 0x42 0x4d 0x43 0x41 0x52 0x36 0x34
# 0x5a 0x41 0x4c 0x4f 0x4e 0x35 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0
# 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0
# 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0
# 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0
# 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0
# 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0
# 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0
# 0x0 0 0
# 3. But I can get the host name.
# 4. My ipmitool version is
# ipmitool version 1.8.18
# Thanks

function action()
{
    # send 132 bytes message
    ipmitool -v raw 0x32 0x6c 1 0 0x0 0xd 0x42 0x4d 0x43 0x41 0x52 0x36 \
             0x34 0x5a 0x41 0x4c 0x4f 0x4e 0x35 0x0 0x0 0x0 0x0 0x0     \
             0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0    \
             0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0    \
             0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0    \
             0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0    \
             0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0    \
             0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0    \
             0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0    \
             0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0 0
}

main() {
	[ "$1" ] && usage
	action
}

main $@

exit 0
